<link rel="stylesheet" href="__STATIC_LIB__layui/css/layui.css"><form class="layui-form seller-form"  action="" ></form><div class="table-body">    <div class="layui-tab layui-tab-card" lay-filter="popup-tab">        <ul class="layui-tab-title">            <li lay-id="all">全部<span class="layui-badge layui-bg-gray">{$count|default=0}</span></li>            <li class="layui-this" lay-id="on">有效期<span class="layui-badge layui-bg-green">{$count_on|default=0}</span></li>            <li lay-id="off">失效期<span class="layui-badge layui-bg-green">{$count_off|default=0}</span></li>            <!--<li lay-id="del">回收站<span class="layui-badge layui-bg-green">{$count_del|default=0}</span></li>-->        </ul>        <div class="layui-tab-content">            <table class="layui-hide" id="popup" lay-filter="popup"></table>            <script type="text/html" id="toolbarDemo">                <div class="layui-btn-container">                    <button class="layui-btn layui-btn-sm" lay-event="create">新增</button>                    <!--<button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>-->                    <!--<button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>-->                </div>            </script>            <script type="text/html" id="barDemo">                <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>                {{# if(d.status == '1'){ }}                <a class="layui-btn layui-btn-danger layui-btn-xs layui-btn-danger" lay-event="end">停用</a>                {{# }else{ }}                <a class="layui-btn layui-btn-danger layui-btn-xs layui-btn-warm" lay-event="start">启用</a>                {{# } }}                {{# if(d.is_delete == '0'){ }}                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>                {{# }else{ }}                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="restore">还原</a>                {{# } }}            </script>        </div>    </div></div><script src="__STATIC_JS__jquery.min.js" type="text/javascript" charset="utf-8"></script><script src="__STATIC__/layui/layui.js" type="text/javascript" charset="utf-8"></script><script>    layui.use(['form','table','element'], function(){        var layer = layui.layer,            table = layui.table,            $ = layui.jquery,            element = layui.element;        var filter = {};        table.render({            elem: '#popup'            ,url: "{:url('Delivery/popup')}"            ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板            ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可                title: '提示'                ,layEvent: 'LAYTABLE_TIPS'                ,icon: 'layui-icon-tips'            }]            ,title: '弹窗数据表'            ,cols: [[                {type: 'checkbox', fixed: 'left'}                ,{field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true}                ,{field: 'images', title: '头像', width:60, align: 'center',templet: function(data){                        return '<a href="javascript:void(0);" onclick=viewImage("'+data.images+'")><image style="max-width:30px;max-height:30px;" src="'+data.images+'"/></a>';                    }}                ,{field:'type', title:'活动分类', width:120,templet:function (res) {                        if(res.type == '1')                        {                            return "活动单页";                        } else if(res.type == '2')                        {                            return "商品活动";                        } else if(res.type == '3')                        {                            return "店铺活动";                        }                    }}                ,{field:'status', title:'活动状态', width:120,templet:function (res) {                        return res.status == '1' ? '启用' : '禁用';                    }}                // ,{field:'is_delete', title:'处理状态', width:120,templet:function (res) {                //         return res.is_delete == '1' ? '已软删' : '未软删';                //     }}                ,{field:'startTime', title:'开始日期', width:120}                ,{field:'entTime', title:'结束日期', width:120}                ,{field:'created_at', title:'加入时间', width:180}                ,{fixed: 'right', title:'操作', toolbar: '#barDemo', minWidth:200}            ]]            ,page: true            ,id:'popup'        });        element.on('tab(popup-tab)', function (data) {            var type = this.getAttribute('lay-id');            if(type === 'on') //有效            {                filter.popup_on = 'on';            } else if(type === 'off')//无效            {                filter.popup_on = 'off';            }else if(type === 'del')//软删            {                filter.popup_on = 'del';            } else if(type === 'all'){                filter.popup_on = 'all';            }                var basefilter = $(".seller-form").serializeArray();            // console.log(basefilter);            $.each(basefilter, function (i, obj) {                if(!filter.hasOwnProperty(obj.name)){                    filter[obj.name] = obj.value;                }            });            table.reload('popup',{                where: filter,                page: {curr: 1}            });        });        //头工具栏事件        table.on('toolbar(popup)', function(obj){            var checkStatus = table.checkStatus(obj.config.id);            switch(obj.event){                case 'create':                    // console.log("222");                    //多窗口模式，层叠置顶                    layer.open({                        type: 2 //此处以iframe举例                        ,title: '新增'                        ,area: ['800px', '700px']                        ,shade: 0                        ,maxmin: true                        // ,offset: [ //为了演示，随机坐标                        //     Math.random()*($(window).height()-300)                        //     ,Math.random()*($(window).width()-390)                        // ]                        ,content: "{:url('Delivery/add_popup')}"                        // ,btn: ['继续弹出', '全部关闭'] //只是为了演示                        ,yes: function(){                            $(that).click();                        }                        ,btn2: function(){                            layer.closeAll();                        }                        ,zIndex: layer.zIndex //重点1                        ,success: function(layero){                            layer.setTop(layero); //重点2                        }                    });                    break;                case 'getCheckLength':                    var data = checkStatus.data;                    layer.msg('选中了：'+ data.length + ' 个');                    break;                case 'isAll':                    layer.msg(checkStatus.isAll ? '全选': '未全选');                    break;                //自定义头工具栏右侧图标 - 提示                case 'LAYTABLE_TIPS':                    layer.alert('这是工具栏右侧自定义的一个图标按钮');                    break;            }        });        //监听行工具事件        table.on('tool(popup)', function(obj){            var data = obj.data;            //console.log(obj)           if(obj.event === 'edit'){               layer.open({                   type: 2 //此处以iframe举例                   ,title: '编辑'                   ,area: ['800px', '700px']                   ,shade: 0                   ,maxmin: true                   // ,offset: [ //为了演示，随机坐标                   //     Math.random()*($(window).height()-300)                   //     ,Math.random()*($(window).width()-390)                   // ]                   ,content: "{:url('Delivery/edit_popup')}?id="+data.id                   // ,btn: ['继续弹出', '全部关闭'] //只是为了演示                   ,yes: function(){                       $(that).click();                   }                   ,btn2: function(){                       layer.closeAll();                   }                   ,zIndex: layer.zIndex //重点1                   ,success: function(layero){                       layer.setTop(layero); //重点2                   }               });                // layer.prompt({                //     formType: 2                //     ,value: data.email                // }, function(value, index){                //     obj.update({                //         email: value                //     });                //     layer.close(index);                // });           } else if(obj.event === 'start')           {               $.ajax({                   url: '{:url("Delivery/open_or_end")}',                   type: 'get',                   data: {id:data.id,type:'open'},                   dataType: 'json',                   success: function (e) {                       if(e.status === true)                       {                           layer.msg(e.msg);                           // var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引                           // parent.layer.close(index); //再执行关闭                           location.reload();                       }else{                           layer.msg(e.msg);                       }                   }               });               return false;           } else if(obj.event === 'end')           {               $.ajax({                   url: '{:url("Delivery/open_or_end")}',                   type: 'get',                   data: {id:data.id,type:'end'},                   dataType: 'json',                   success: function (e) {                       if(e.status === true)                       {                           layer.msg(e.msg);                           // var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引                           // parent.layer.close(index); //再执行关闭                           location.reload();                       }else{                           layer.msg(e.msg);                       }                   }               });               return false;           } else if(obj.event === 'del')           {               layer.confirm('确定将该条记录加入回收站吗？', function(index){                   $.ajax({                       url: '{:url("Delivery/delete")}',                       type: 'get',                       data: {id:data.id},                       dataType: 'json',                       success: function (e) {                           if(e.status === true)                           {                               layer.msg(e.msg);                               // var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引                               // parent.layer.close(index); //再执行关闭                               // table.reload('popup');                               location.reload();                           }else{                               layer.msg(e.msg);                           }                       }                   });                   obj.del();                   layer.close(index);                   return false;               });           } else if(obj.event === 'restore')           {               layer.confirm('确定还原该记录吗？', function(index){                   $.ajax({                       url: '{:url("Delivery/restore")}',                       type: 'get',                       data: {id:data.id},                       dataType: 'json',                       success: function (e) {                           if(e.status === true)                           {                               layer.msg(e.msg);                               // var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引                               // parent.layer.close(index); //再执行关闭                               // table.reload('popup');                               location.reload();                           }else{                               layer.msg(e.msg);                           }                       }                   });                   return false;               });           }        });    });</script>